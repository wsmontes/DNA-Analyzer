/**
 * @gmod/tabix v1.5.0
 * Tabix file format parser
 *
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@gmod/bgzf-filehandle")):"function"==typeof define&&define.amd?define(["exports","@gmod/bgzf-filehandle"],e):e((t=t||self).tabix={},t.bgzf)}(this,function(t,r){"use strict";r=r&&r.hasOwnProperty("default")?r.default:r;var o=function(){function t(){this.minKey=null,this.maxKey=null,this.midpoint=null,this.count=0,this.children={}}var e=t.prototype;return e.addInterval=function(t,e,n){for(var i=t,r=e,o=n,a=function(t){i<t.minKey||null===t.minKey&&(t.minKey=i),r>t.maxKey||null===t.maxKey&&(t.maxKey=r),t.midpoint=(t.maxKey+t.minKey)/2,t.count+=1},s={chr:o,start:i,end:r};o;)a(this.children[o]||(this.children[o]=new this.constructor)),o=this._nextChrName(o);a(this.children[null]||(this.children[null]=new this.constructor))},e.overlapsWith=function(t,e,n){var i=this.children[n];if(!i)return!1;if(null===i.minKey||null===i.maxKey)return!1;var r=i.maxKey<t,o=e<i.minKey;return!(r||o)},e._nextChrName=function(t){if(t.length&&t[t.length-1].match(/^[0-9]+$/)){var e=parseInt(t.length&&t[t.length-1],10);return e?t.slice(0,-1)+e:null}return null},t}(),a=function(){function t(t){var e=t.columnNumbers,n=void 0===e?{ref:0,start:1,end:2}:e,i=t.filehandle,r=t.metaChar,o=void 0===r?"#":r,a=t.commentChar;this.columnNumbers=n,this.filehandle=i,this.metaChar=o,this.commentChar=void 0===a?"#":a,this.index=new this._IndexClass,this.readIndex()}var e=t.prototype;return e._parseColumns=function(t){return t.split("\t")},e._returnValue=function(t){return t},e.getColumnCount=function(){return Object.values(this.columnNumbers).reduce(function(t,e){return Math.max(t,e)},0)},e.lineIsComment=function(t){return t.length&&t[0]===this.commentChar||t.startsWith(this.metaChar)},e.parseColumns=function(t){var e=this._parseColumns(t);if(e.length<=this.getColumnCount())return!1;var n,i=this.columnNumbers,r=i.ref,o=i.start,a=i.end;return void 0===a&&(a=o),{chr:n=e[r],start:parseInt(e[o],10),end:parseInt(e[a],10),fields:e,value:this._returnValue(e)}},e.parseAndSave=function(t,e){try{var n=this.parseColumns(t);n&&e(n)}catch(e){throw new Error("tabix parse error parsing line: "+t+" ("+e+")")}},e._parseLine=function(t,e){void 0===e&&(e=function(){return!0}),this.lineIsComment(t)||this.parseAndSave(t,function(t){t&&e(t)&&this.index.addInterval(t.start,t.end,t.chr)}.bind(this))},e.readIndex=function(){throw new Error("not implemented")},e.lineCount=function(){throw new Error("not implemented")},e.getLines=function(t,e,n,i){throw new Error("not implemented")},e.getMetadata=function(){throw new Error("not implemented")},t.prototype._IndexClass=o,t}();function s(t){if(t.length&&t[t.length-1].match(/^[0-9]+$/)){var e=parseInt(t.length&&t[t.length-1],10);return e?t.slice(0,-1)+e:null}return null}var n=function(){function t(t,e){this.minKey=t||null,this.maxKey=e||null,this.midpoint=null,this.count=0,this.children={start:{},end:{}}}var e=t.prototype;return e.addInterval=function(t,e,n){for(var i=t,r=e,o=n;o;)this._findNode(o,!0).addInterval(i,r),o=s(o);this._findNode(null,!0).addInterval(i,r)},e._findNode=function(t,e){void 0===e&&(e=!1);var n=this.children;return t&&(n=t in n?n[t]:e?(n[t]=new i,n[t]):null),n},e._getNode=function(t){return this._findNode(t)},e.overlapsWith=function(t,e,n){var i=this._getNode(n);return!!i&&i.overlapsWith(t,e)},t}(),i=function(){function t(){this.minKey=null,this.maxKey=null,this.midpoint=null,this.count=0,this.startList=[],this.endList=[]}var e=t.prototype;return e.addInterval=function(t,e){var n=this;this.minKey=Math.min(t,null===this.minKey?t:this.minKey),this.maxKey=Math.max(e,null===this.maxKey?e:this.maxKey),this.midpoint=(this.maxKey+this.minKey)/2,this.count+=1;var i=this.startList.length;if(!i)this.startList.push(t),this.endList.push(e);else if(t<=this.startList[i-1])!function(){if(t===n.startList[i-1]&&e<=n.endList[i-1])return n.startList.pop(),n.endList.pop(),n.startList.push(t),void n.endList.push(e);for(var r=i-1;0<=r&&t<n.startList[r];r-=1);for(var o=Math.max(0,r),a=i-1;o<=a;a-=1)n.startList[a+1]=n.startList[a],n.endList[a+1]=n.endList[a];n.startList[r+1]=t,n.endList[r+1]=e}();else{if(t===this.startList[i-1]&&e<=this.endList[i-1])return this.startList.pop(),this.endList.pop(),this.startList.push(t),void this.endList.push(e);this.startList.push(t),this.endList.push(e)}},e.overlapsWith=function(t,e){if(null===this.minKey||null===this.maxKey)return!1;var n=this.maxKey<t,i=e<this.minKey;if(n||i)return!1;for(var r=0;r<this.startList.length;r+=1)if(!(e<this.startList[r]||t>this.endList[r]))return!0;return!1},t}();function c(t){var e=10*(65535&t)+(t>>>16);return 32|e>>8&192|e&31}function l(t){var e=0;if(3===t)return this.path=[1,1,1];for(;t;)this.path[e]=1&t,t>>=1,e+=1;this.path[this.maxD]=1}function h(t){var e=0,n=t.length;for(e=0;e<n;++e)if(t[e])return e;return n}function u(t,e,n){var i=[];return{length:t,push:function(t,e,n){return i.push([t,e,n])},shift:function(){var t=i.length?i.shift():[e,e,n];return t[1]-t[0]<t[2]?t:[0,0,0]},N:function(){return i.length}}}function f(t,e){if(t===e)return t.length;var n=Math.max(t.length,e.length),i=new Array(2*n);if(i.fill(0),t===e)return 0;var r=Math.min(t.length,e.length),o=function(t,e,n,i,r){for(var o=0;o<i;++o){var a=c(t.charCodeAt(o)),s=c(e.charCodeAt(o));r&&(a^=s,s=0),n[o]=a,n[o+i]=s}};o(t,e,i,r,0);for(var a=r;a<t.length;++a)i[a]=c(t.charCodeAt(a));for(var s=r;s<e.length;++s)i[s+n]=c(e.charCodeAt(s));var f=function(t,e,n,i,r){for(var o=0,a=0;a<n;){var s=(a+1)%i,c=t[a],l=t[s],h=e[a],u=e[s],f=1!=-1>>>1?c==h?c==l&&h==u?0:1:1:c==h&&l==u?0:1;1&f?o+=r:o+=1-r,a=s}return o},p=0,d=Math.pow(2,30)-1;if(f(i,i.slice(n),n,n,1)&1){if(f(i,i.slice(n),n,n,.5)>d)p=1;i[n-1]^=4|p}else{if(f(i,i.slice(n),n,n,.5)>d)p=1;i[n-1]^=4|p}var v,g,m=Math.floor(n/2);for(v=0;v<n;++v)i[v]^=i[(v+m)%n];for(v=0,g=0;v<n;++v)g+=(i[v]&3)+((i[v]>>>2&3)<<2);var y=n-4,b=i[y],N=i[y+1],w=i[y+2],k=i[y+3],C=g%15;l.call(this,C);var L=h(this.path);return L===this.maxD&&(this.path[this.maxD-1]=1),this.path[L]=1,this.path[L+1]=1,this._compute(t,e),this.D}var p=function(){function e(t){this.maxD=19,this.path=new Array(this.maxD+1),this.path.fill(0),this.Peq=new Uint32Array(256),this.P=new Uint32Array(10),this.M=new Uint32Array(10),this.score=t||64}var t=e.prototype;return t._compute=function(t,e){if(t===e)return 0;var n=Math.max(t.length,e.length),i=0,r=0,o=Math.min(t.length,e.length),a=Math.min(this.maxD,Math.floor(n/4+1)),s=Math.min(o,a),c=n-o,l=c<=s,h=l?n-c+1:n-(s<<1)+1,f=u(h,s,c),p=new Uint32Array(Math.ceil((n+1)/32)),d=new Uint32Array(Math.ceil((n+1)/32));for(r=0;r<Math.ceil((n+1)/32);++r)p[r]=0,d[r]=~0;for(i=0;i<this.maxD+1;++i)if(this.path[i]){var v=l?i:i<=c?0:i-c,g=l?i+c:i;if(t.length<=e.length?this.diff_core(e,t,g-v,s,p,d,f):this.diff_core(t,e,g-v,s,p,d,f),o=f.N(),!o)break}return n-f.shift()[2]},t.diff_core=function(t,e,n,i,r,o,a){var s=t.length,c=e.length,l=Math.min(s,c),h=s+c,u=t===e?0:1,f=new Array(this.P.length);this.Peq.fill(0);for(var p=0;p<c;++p){var d=void 0;d=1&u?e.charCodeAt(p):t.charCodeAt(p);var v=1<<(31&p);this.Peq[d]|=v}var g=Math.floor(c/32)+1,m=void 0,y=0,b=0,N=0,w=0,k=0,C=0,L=0,_=0;for(y=0;y<this.P.length;++y)this.P[y]=~0,this.M[y]=0;for(m=0;m<=n&&(C=_(L=!(N=(k=y=s-(_=m))+c)%2)?N/2-_/2:Math.ceil(N/2)-Math.floor(_/2),(L=s-(w=m)+c,!(w&&C<0||s<k)));++m){var D=0;D=m<=i?m:m>s-i+c?m-(s-i+c)+i:i;var x=0,O=D;for(f.fill(0),f[0]=this.P[0],y=0;y<Math.ceil(c/32);++y){var S=this.Peq[t.charCodeAt(k-1)];--k;for(var j=0;j<Math.min(32,k+1);++j){var A=1<<(31&j);this.M[y]=(f[y]&(r[y]|A))|(this.P[y]&(o[y]|A))&S,this.P[y]=f[y]&r[y]|~(f[y]|r[y])|~S,S=this.M[y]}}if(!this.M[Math.floor((c-1)/32)]&&(1<<(31&(c-1))))--O;for(b=1;b<=D;++b)f[b]=this.P[b-1],S=this.Peq[t.charCodeAt(k-1)],--k;for(var I=0;I<Math.ceil(c/32);++I){for(j=0;j<Math.min(32,k+1);++j)A=1<<(31&j),this.M[I]=(f[b]&(r[I]|A))|(this.P[I]&(o[I]|A))&S,this.P[I]=f[b]&r[I]|~(f[b]|r[I])|~S,S=this.M[I];++b}if(!this.M[Math.floor((c-1)/32)]&&(1<<(31&(c-1))))--O;if(x=O,void 0===x||w+x>h)return;C=L%2?L/2-w/2:Math.floor(L/2)-Math.floor(w/2);var P=s-C-w;if(P<0||c<P)return;a.push(C,P,x)}return x},e}();function d(t,e){for(var n=e.length,i=0;i<n;i++)for(var r=e[i],o=0;o<r.length;o++)t[o]+=r[o]}function v(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e.map(function(t){return t.length});if(!(i=i.every(function(t,e,n){return!e||t===n[e-1]})))throw new Error("util.cumsum - all input arrays must be the same size");var r=e[0].length,o=[];d(o,e);for(var a=[],s=0,c=0;c<r;c++)a.push(s),s+=o[c];return a}function g(t){for(var e=arguments.length,n=new Array(1<e?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var r=n[0]||512;return{bufferLength:r,size:function(){return t.size()},slice:function(e,n,i){var r=arguments;return 3<arguments.length?t.slice.apply(t,r):t.slice(e,n,i)},read:function(e,n,i){var r=this;void 0===n&&(n=0);var o=t.size(),a=void 0===i?o:i,s=function(i,s){var c=r.bufferLength;if(i<a){var l=Math.min(i+c,a);return t.slice(i+e,l+e).then(function(t){return n(t,i,s),s||l===a?s:s?s.concat(t):i?[t]:t})}return s};return function t(e,n){return s(e,n).then(function(n){return n||t(e+r.bufferLength,n)})}(0)}}}function m(t){var e=t.lastIndexOf("\n"),n=t.lastIndexOf("\r");return t.slice(0,Math.max(e,n))}function y(t){if(t)return String.fromCharCode.apply(String,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(t instanceof Uint8Array?t:new Uint8Array(t)))}var b=function(t){function e(e,n){var i;return void 0===n&&(n={}),(i=t.call(this,e)||this).options=n,i.BED=1,i.CRAM=2,i.CRAI=3,i.CSI=4,i.FASTA=5,i.FAI=6,i.GFF=7,i.VCF=8,i.TBI=9,i.BAI=10,i.TBIDX=11,i.CRIDX=12,i.format=i.options.format,i.hasRefSeqChrom=i.options.refSeqChrom,i._returnFullTags=i.options.returnFullTags,i.encoding=i.options.encoding,!i.encoding&&i.format&&(i.encoding=i.BED===i.format||i.GFF===i.format?"utf-8":"latin1"),i}r(e,t);var o=e.prototype;return o.readLine=function(t,e,n){var i=t;if(i=(e?i.slice(e):i).toString(this.encoding),n&&(i=i.substr(0,n)),i){var r=i.indexOf("\n"),o=i.indexOf("\r");if(-1!==r|||-1!==o){var a=r;return-1!==o&&o<r&&(a=o),{line:i.substr(0,a),offset:a}}}return{line:i,offset:i.length}},o.readBED=function(t,e,n,i){var r=this.readLine(t,e,n),o=r.line,a=r.offset;if(!o.length)return{bytesRead:a,buffer:null};var s=o.split("\t"),c=7<s.length?s[7]:0;return{bytesRead:a,buffer:i?{end:+s[2],start:+s[1],rest:s,number:+c,offset:e}:s}},o.readFASTA=function(){throw new Error("FASTA parsing not yet implemented")},o.readVCF=function(t,e,n,i){var r=this.readLine(t,e,n),o=r.line,a=r.offset;if(("##"===o.substr(0,2)||"#"===o[0])&&!i)return{bytesRead:a,buffer:null};var s=o.split("\t");return{bytesRead:a,buffer:s}},o.parseLine=function(t,e,n,i){void 0===i&&(i=!1);var r=this.format;return r===this.FASTA?this.readFASTA(t,e,n,i):r===this.BED?this.readBED(t,e,n,i):r===this.VCF?this.readVCF(t,e,n,i):{bytesRead:y(t.slice(e,e+n)).length,buffer:y(t.slice(e,e+n))}},o.parseAsText=function(t){return y(t)},o.parseDepth=function(t){return t.toString("utf8").split("\n").filter(function(t){return!!t}).map(function(t){return t.split("\t")})},o.parseWig=function(t){var e=t.toString("utf8").split("\n"),n=[],i=[],r={};n.push(r);for(var o=function(t){if(t.startsWith("fixedStep")||t.startsWith("variableStep")){var e=t.split(" ");if("fixedStep"===e[0]){var o=e.filter(function(t){return t.startsWith("chrom=")}).map(function(t){return t.split("=")[1]}),a=e.filter(function(t){return t.startsWith("start=")}).map(function(t){return+t.split("=")[1]}),s=e.filter(function(t){return t.startsWith("step=")}).map(function(t){return+t.split("=")[1]}),c=1;e.filter(function(t){return t.startsWith("span=")}).forEach(function(t){return c=+t.split("=")[1]});for(var l=+a[0],h=s[0],u=0;u<i.length;u++){var f=[o[0],l,l+c,i[u]];n.push(f),l+=h}i=[]}else{var p=e.filter(function(t){return t.startsWith("chrom=")}).map(function(t){return t.split("=")[1]}),d=1;e.filter(function(t){return t.startsWith("span=")}).map(function(t){return+t.split("=")[1]}).forEach(function(t){return d=+t});for(var v=0;v<i.length;v+=2){var g=[p[0],+i[v],+i[v]+d,+i[v+1]];n.push(g)}i=[]}}else i.push(t)},a=0;a<e.length;a++)o(e[a]);return n.filter(function(t){return Object.keys(t).length})},o.readCSI=function(){throw new Error("CSI parsing not yet implemented")},o.readTabix=function(t,e){if(void 0===e&&(e={}),1179648195!==t.readInt32LE(0))throw new Error("Not a BAI/tabix file, invalid magic number");var n=t.readInt32LE(4);if(n<0||2<n)throw new Error("Only support BAI/tabix files with version <= 2");var i=t.readInt32LE(8),r=12,o=[],a=1===i?105:n?65535:4681<<-1>>>0;if(e.auxData&&(a=e.auxData),i||(i=t.readInt32LE(r),r+=4),i<0)throw new Error("invalid n_refs in tabix header");for(var s=t.readInt32LE(r),c=(r+=4)+s,l=e.refIdToName,h=0;h<i;h++){r>c&&(r=c);var u=o[h]=[];if(r>=t.length)continue;for(var f=t.readInt32LE(r),p=(r+=4)+f;r>0&&r<p;){var d=t.readInt32LE(r),v=(r+=4)+16*d;if(0!==d)for(var g=t.readInt32LE(r),m=t.readInt32LE(r+4),y=t.readInt32LE(r+8),b=t.readUInt32LE(r+12),N={minv:g,maxv:m,bin:y};r+=16,r<v&&b;){var w=new Array(b);u.push(N),N.chunks=w;for(var k=0;k<b;k++){var C=t.readUInt64LE(r),L=t.readUInt64LE(r+8);w[k]={minv:C.lo+((C.hi&65535)<<32),maxv:L.lo+((L.hi&65535)<<32)},r+=16}}else{var _={minv:0,maxv:0,bin:d};u.push(_)}if(r>=p)break}}var D=e.getRefName;l&&(D=function(t){return l[t]||{name:t.toString()}});var x=h;for(if(e.firstVirtSeeked||(x=0);x<i;x++){var O=o[x];if(!e.firstVirtSeeked&&x>0){var S=l&&l[x-1]?l[x-1].end:0;Object.assign(O,{linearCount:0,csi:n,firstVirtSeeked:S+1})}Object.assign(O,{refId:x,ref:D?D(x):null})}return o},o.readTBI=function(t,e){void 0===e&&(e={});var n=0,i=y(t.slice(n,n+=3)),r=t.readUInt8(n++);if(console.log(i),console.log(r),"TBI"!==i||1!==r)throw new Error("not a tabix index");var o=t.readInt32LE(n);n+=4;var a=t.readInt32LE(n);n+=4;var s=t.readInt32LE(n);n+=4;var c=t.readInt32LE(n);n+=4;var l=t.readInt32LE(n),h={columns:o,format:a,skip:s,commentChar:c,coordinateFormat:l};n+=4;var u=t.readInt32LE(n);n+=4;var f=n,p=n+u,d=e.refNameToId?e.refNameToId:{},v={};for(;n<p;){var g=m(t.slice(n,p).toString("utf8")),b=g.length;n+=b+1,d[g]=Object.keys(d).length}var N=t.slice(f+u);return{columnNumbers:h,metaChar:""+String.fromCharCode(c),indexParsed:this.readTabix(N,{refIdToName:v,firstVirtSeeked:1,auxData:65535,getRefName:function(t){return Object.keys(d)[t]}}),refNameToId:d}},o.readBAI=function(t,e){void 0===e&&(e={});var n={};return{baiVersion:1,indexParsed:this.readTabix(t,{refIdToName:n,firstVirtSeeked:1,auxData:4681})}},e}(function(){function t(t){var e=t&&t.filehandle;this.filehandle=e,this.length=0}return t.prototype.tell=function(){return this.filepos},t}());function N(){var r=function(t){var e=0;return function(){return e+=t}}(1);return function(t){var e,n=(e=r()+"-"+String(Math.random()).slice(2)).toString();return t.length?n.slice(0,e.length-t.length)+t:n.slice(0,e.length)}}var w;Math.log(32);function k(t){if("number"==typeof t)w?w(t,t+1):(w=Object.getOwnPropertyDescriptor(new ArrayBuffer(0),0),w=w?w.get:function(){return 0});else{var e=t;return e.length?e.readUInt32LE(0):0}}"function"!=typeof Buffer.prototype.readBigInt64LE&&(Buffer.prototype.readUInt64LE=function(t){var e=this.readUInt32LE(t),n=this.readUInt32LE(t+4);return{hi:n,lo:e}}),Buffer.prototype.writeBig=function(t,e){return"number"==typeof t?(this.writeInt32LE(t&-1,e),this.writeUInt32LE(Math.floor(t/4294967296),e+4)):"bigint"==typeof t?{hi:Number(t>>32n),lo:Number(4294967295n&t)}:t.constructor===Object&&"lo"in t&&"hi"in t?(this.writeInt32LE(t.lo&-1,e),this.writeUInt32LE(4294967295&t.hi,e+4)):(this.writeInt32LE(t[0]&-1,e),this.writeUInt32LE(t[1]&-1,e+4)),e+8},Uint8Array.prototype.readUInt64LE=function(t){return{hi:k(this.slice(t+4,t+8)),lo:k(this.slice(t,t+4))}},Uint8Array.prototype.readInt32LE=Buffer.prototype.readInt32LE=function(t){return k(this.slice(t,t+4))-(4294967296&k(this.slice(t+3,t+4)))},Uint8Array.prototype.readUInt32LE=function(t){return k(this.slice(t,t+4))},Uint8Array.prototype.readUInt8=function(t){return k(this.slice(t,t+1))},String.prototype.codePointAt||(String.prototype.codePointAt=function(t){if(null==this)throw TypeError();var e=String(this),n=e.length;if(0==(0|=(0|t)?t<0?Math.max(n+t,0):Math.min(t,n-1):0))return e.charCodeAt(0);var i=e.charCodeAt(0);return 55296<=i&&i<=56319&&1+0<n?(i-55296)*1024+(e.charCodeAt(1+0)-56320)+65536:i});var C=function(){function o(t){var e=t.filehandle,n=t.tbiFilehandle,i=t.csiFilehandle,r=t.chunkSizeLimit;this.chunkSizeLimit=void 0===r?1e7:r,this.filehandle=e,n&&(this.index=this.readIndex(n,{type:"TBI"})),i&&(this.index=this.readIndex(i,{type:"CSI"}))}var t=o.prototype;return t.readIndex=function(t,e){var n=new b({});return"CSI"===e.type?n.readCSI(t):n.readTBI(t)},t.getHeader=function(){var t=this;return this.filehandle.read(0,5e5).then(function(e){var n=new b({format:8}),i=e,r=0,o=[];do{var a=n.parseLine(i,r);if(void 0===a)throw new Error("misparsed header");var s=a.bytesRead;if(r+=s+1,a.buffer){var c=a.buffer[0];if("#"!==c[0])break;o.push(a.buffer)}}while(r<5e5);var l={"##fileformat":"VCFv4.2","##fileDate":"20200101","##source":"NCBI dbSNP","##INFO":"<ID=RSPOS,Number=1,Type=Integer,Description='Chr position reported in dbSNP'>"};return o.length&&(l=o.reduce(function(t,e){if("##"===e[0].slice(0,2)){var n=e[0],i=(n=n.slice(2)).split("="),r=i[0],o=i[1];"fileDate"!==r&&"source"!==r&&"contig"!==r&&(t["##"+r]=o)}return t},{})),{header:o,parsedHeader:l,textDecoder:t.tbiIndex?t.tbiIndex.textDecoder:null}})},t.getLines=function(e,n,i,r,o){var a=this;void 0===o&&(o=function(){return!0});var s=this.index.indexParsed[e];if(!s)throw new Error("invalid chr name");for(var c=0,l=[],h=this.index.columnNumbers,u=h.start+1,f=h.end||h.start,p=s||[],d=0;d<p.length;d++){var v=p[d];if(v.chunks)for(var g=0;g<v.chunks.length;g++){var m=v.chunks[g];if(v.maxv-u>=n&&v.minv+f<=i){var y=Math.max(0,m.minv),b=Math.max(0,Math.min(m.maxv,this.filehandle.size||Number.MAX_SAFE_INTEGER));if(c+=b-y,c>this.chunkSizeLimit)throw new Error("Too much VCF data, limit is "+(this.chunkSizeLimit/1e6).toFixed(0)+"MB");y<b&&l.push([y,b])}}}for(var N=l.sort(function(t,e){return t[0]-e[0]}),w=[],k=function(t,e,n,i){var r=n&&n[1]?n[1]:0,o=void 0===i?0:i;function a(t,e){var n=Math.max(0,t),i=Math.min(e);return n<i?[n,i]:null}function s(t,e){for(var n,i=[],r=0;r<e.length;r++){var o=t,a=e[r];o[0]<a[0]?a[0]<=o[1]&&o[1]<a[1]?o[1]=a[0]-1:o[1]>=a[1]||i.push(o):o[0]<=a[1]&&o[0]>a[0]?o[0]=a[1]+1:o[0]>a[1]||i.push(o)}return i.sort(function(t,e){return t[0]-e[0]}),n=i,n.length?n[n.length-1][1]-n[0][0]+1:0}function c(t){return t[1]-t[0]+1}function l(t){return t.reduce(function(t,e){return c(e)+t},0)}var h=[],u=0;return h.push(a(t-r,e+o)),h=function(t,e){for(var n=[],i=e[0];i<e[1];i++){for(var r=!1,o=0;o<t.length;o++)t[o][0]<=i&&i<=t[o][1]&&(r=!0);r?n.push(i):n.length&&n.push(i)}var a=[];for(o=0;o<n.length;o++){var s=o>0?n[o-1]:null,c=n[o];(0===o||c-1!==s)&&(a.push([c,c]),u+=1),a.length&&(a[a.length-1][1]=c,u+=c-a[a.length-1][0])}return a}(n,h[0]),1e6<(u=s(h[0],n))?t:(0===l(h)?h.push([t,e]):u<=1e5&&(h=[a(t,e)]),h)}(N),C=k(N),L=C.length,_=0;_<L;_++){var D=C[_];"object"==typeof D&&2===D.length&&D[0]<D[1]&&(D=this.filehandle.read(D[0],D[1]-D[0])).then(function(){return function(t){var e=t,n=new b({format:8}),i=0,s=e.length,c=[],l=a.index.columnNumbers;do{var h=n.parseLine(e,i);if(void 0===h)break;if(0!==(i+=h.bytesRead))i++;else if(i>=s)break;var u=h.buffer;if(u){var f=u[0];if("#"===f[0])continue;var p=u[l.ref],d=+u[l.start];if(o(u)&&p===r&&d<=i&&n+1>=d){var v=[],g=u.slice();for(c.push(g);v.length;){var m=v.shift();c.push(m)}}}}while(i<s);return c}}(D))}var x,O=[];if(1===w.length)return w[0].then(function(t){return t});for(x=0;x<w.length;x++)O=O.concat(w[x].value);return{length:0,forEach:function(t){for(var e=0;e<w.length;e++)w[e].then(function(e){return e.forEach(t)})}},Promise.all(w).then(function(t){return t.reduce(function(t,e){return t.concat(e)},[])})},o}();function L(t,e,n){var i,r=function(t,e){return n?new p(t).diff_core(t,e,0,t.length):"string"!=typeof t||"string"!=typeof e?t.length:f.call(new p,t,e)}(t,e);return r<30&&(i=!0),{result:i,score:r}}function _(t,e){return!!t&&(!!e&&t.length===e.length)}function D(t){return t.startsWith("chr")?t.slice(3):t}function x(){var e=function(t){return t.split(",").map(function(t){return t.trim()}).filter(function(t){return!!t})}("alias,seqName,name,refName,sequenceName,seqId,reference_name,ucscName,referenceName,seq_name"),i=N()();return function(n,r){var o=t.TabixIndexedFile.matchRefName(n,r);if(void 0!==o)return o;var a=D(n);o=t.TabixIndexedFile.matchRefName(a,r);if(void 0!==o)return o;var s=function(t){if(!t)return t;var n="";return t.includes(".")?(n=t.split(".")[0],n=e.reduce(function(e,i){return e||t[i]===n&&n},"")):n=t,n}(n);return!s||s===n?void 0:(o=t.TabixIndexedFile.matchRefName(s,r),void 0!==o?o:(a=D(s),void 0!==(o=t.TabixIndexedFile.matchRefName(a,r))?o:void 0))}}var O=x();t.CSI=n,t.TabixIndexedFile=C,t.VCFParser=a,t.blast=L,t.cumsum=v,t.diff=f,t.matchRefName=function(t,e){if(!t||!e)return!1;if(e[t])return t;var n=t.toLowerCase();for(var i in e){var r=i.toLowerCase();if(r===n)return i}return!1},t.parseBreakpoint=function(t){var e=/^(\w+):(\d+)(-(\d+))?/.exec(t),n=e[1],i=+e[2];void 0===e[4]&&(e[4]=String(i));var r=+e[4];if(i>r){var o=[r,i];i=o[0],r=o[1]}return{refName:n,start:i,end:r}},t.processReadsForVisibleRegion=function(t,e,n,i){var r=i;"undefined"==typeof r&&(r=20);var o=e+n,a=o-e;return{yScaler:function(){var e=[];return t.forEach(function(t){e.push(t)}),e.length<=r?function(t){return t}:function(e){return t[Math.floor(e/r)]}}(),maxYCoordinate:function(){return t.length-1>=r?Math.ceil(t.length/r):t.length}(),indexToFeature:function(t){return t}}},t.regionParser=function(t){var e=t.toLowerCase().split(":"),n=e[0];if(1===e.length)return{refName:n,start:0,end:1e10};if(2===e.length){var i=e[1].split("-");if(1===i.length){if(!/^[0-9]+$/.test(i[0]))return{refName:n};var r=parseInt(i[0],10);return{refName:n,start:r-1,end:r+1}}if(2===i.length){if(!/^[0-9]+$/.test(i[0])||!/^[0-9]+$/.test(i[1]))return{refName:n};var o=parseInt(i[0],10),a=parseInt(i[1],10);if(o>a){var s=[a,o];o=s[0],a=s[1]}return{refName:n,start:o-1,end:a}}console.warn("could not parse region coordinate",e[1])}return{}}});
//# sourceMappingURL=tabix.umd.min.js.map
